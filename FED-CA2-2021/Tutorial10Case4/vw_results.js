"use strict";

/*
   New Perspectives on HTML5 and CSS3, 7th Edition
   Tutorial 10
   Case Problem 4

   Author: Chai Pin Zheng
   Date:   19/7/2020 
   
   Filename: vw_results.js
   
   Functions:
   
   The calcSum() function is a callback function used to
   calculte the total value from items within an array
   
   The calcPercent(value, sum) function calculates the percentage given
   a value and a sum
   
   The createBar(partyType, percent) function writes a different
   table data table based on the candidates party affilication.
   
      
*/

var raceTitle,race,votes,candidate,party;

var reportHTML = "<h1>" + raceTitle + "</h1>";

/* A for loop - loops through the contents of the race array using i as the counter variable,
 that acts as a race Number as well!*/
for (var i = 0; i < race.length; i++) {
   //I used race.length in order to make my code more effecient - reduce the run time making it more effecient!
   var totalVotes = 0;
   votes[i].forEach(calcSum);
   //uses the multidimensional array from votes and passed through a callback function, calcSum() to add the number in the array to a variable, totalVotes
   reportHTML += "<table>";
   reportHTML += "<caption>" + race[i] + "</caption>";
   /* write the name of the current race in the program loop */
   reportHTML += "<tr><th>Candidate</th><th>Votes</th></tr>";
   reportHTML += candidateRows(i, totalVotes);
   /* store the string generated by function,candidateRows() into reportHTML */
   reportHTML += "</table>";
}

//displays the string reportHTML into the section
document.getElementsByTagName("section")[0].innerHTML = reportHTML;

/* Function to pick a specific number from the Arrays in congminn.js and picks it,computes it 
and store into a variable and prints as a string*/
function candidateRows(raceNum, totalVotes) {
   var rowHTML = "";
   for (var j = 0; j <= 2; j++) {
      var candidateName = candidate[raceNum][j];
      //stores a specific data from candidate array into can the variable candidateName
      var candidateParty = party[raceNum][j];
      //stores a specific data from party array into can the variable candidateParty
      var candidatevotes = votes[raceNum][j];
      //stores a specific data from votes array into can the variable candidatevotes
      var candidatePercent = calcPercent(candidatevotes, totalVotes);
      //the function calculates the candidate percentage from the function(candidatesvotes,totalvotes) and stores it into the variable,candidatePercent
      rowHTML += "<tr>";
      rowHTML += "<td>" + candidateName + "(" + candidateParty + ")" + "</td >";
      rowHTML += "<td>" + candidatevotes.toLocaleString() + "(" + candidatePercent.toFixed(1) + "%)" + "</td >";
      for (var k = 0; k < candidatePercent; k++) {
         rowHTML += createBar(candidateParty);
      }/*creates a Loop to loop from 0 to the candidate Percentage to create a number of <td class=""><td>
      in order to create a bargraph as data cells are represented in the color*/
      rowHTML += "</tr>";
   }//loops it 2 times, so as in order to read all the array as the array is sorted in a 8x3 order
   return rowHTML;
   //returns the rowHTML string 
}

//creates the lines graph respective of the demographic party
function createBar(partyType) {
   var barHTML = "";
   //setting the barHTML to an empty string
   switch (partyType) {
      case ("D"):
         barHTML = "<td class='dem'></td>";
         /*If partyType = "D", which is supplied by the candidateParty.If it is correct, it will execute this 
         - <td class='rep'></td>*/
         break;
      //breaks the function, stopping the code here instead of being read all the way
      case ("R"):
         barHTML = "<td class='rep'></td>";
         /*If partyType = "R", which is supplied by the candidateParty.If it is correct, it will execute this 
         - <td class='rep'></td>*/
         break;
      //breaks the function, stopping the code here instead of being read all the way
      case ("I"):
         barHTML = "<td class='ind'></td>";
         /*If partyType = "I", which is supplied by the candidateParty.If it is correct, it will execute this 
         - <td class='rep'></td>*/
         break;
      //breaks the function, stopping the code here instead of being read all the way
   }
   return barHTML;
   //returns the barHTML string - giving the createBar function a value of the <td class=""></td>
}

/* Callback Function to calculate an array sum */
function calcSum(value) {
   totalVotes += value;
}

/* Function to calculate a percentage */
function calcPercent(value, sum) {
   return (100 * value / sum);
}